<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Izzasza's Ultimate Gallery</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"/>
  <style>
    :root {--bg:#0f0f0f; --card:#1a1a1a; --text:#f5f5f5; --accent:#fff; --red:#e74c3c;}
    body.light {--bg:#fafafa; --card:#ffffff; --text:#222; --accent:#000;}
    body {margin:0; background:var(--bg); color:var(--text); font-family:'Segoe UI',sans-serif; transition:0.4s;}
    header {text-align:center; padding:50px 20px; background:linear-gradient(135deg,#000,#222);}
    h1 {font-size:2.8rem; margin:0; background:linear-gradient(90deg,#fff,#aaa);-webkit-background-clip:text; color:transparent;}
    .controls {margin:20px auto; max-width:1000px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;}
    input, button {padding:12px 20px; border:none; border-radius:50px; font-size:1rem;}
    input {background:var(--card); color:var(--text); flex:1; max-width:300px;}
    button {background:var(--accent); color:#000; cursor:pointer; font-weight:600;}
    .gallery {max-width:1400px; margin:0 auto; padding:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:24px;}
    .photo {position:relative; border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.6); transition:0.4s;}
    .photo:hover {transform:translateY(-10px);}
    .photo img {width:100%; height:100%; object-fit:cover;}
    .overlay {position:absolute; bottom:0; left:0; right:0; background:linear-gradient(transparent,#0009); padding:20px; color:#fff;}
    .caption {margin:8px 0; font-size:0.95rem; opacity:0.9;}
    .actions {display:flex; gap:10px; margin-top:8px;}
    .actions button {background:rgba(255,255,255,0.2); padding:6px 12px; border-radius:20px; font-size:0.9rem;}
    .like {color:#e91e63;}
    .delete {background:var(--red);}
    #loginModal {position:fixed; inset:0; background:#000c; display:flex; align-items:center; justify-content:center; z-index:999;}
    .modal {background:var(--card); padding:30px; border-radius:20px; width:90%; max-width:400px; text-align:center;}
    @media(max-width:600px){.gallery{grid-template-columns:repeat(2,1fr);}}
  </style>
</head>
<body>
  <div id="loginModal">
    <div class="modal">
      <h2>Masuk dulu yuk</h2>
      <input type="password" id="pass" placeholder="Password">
      <button onclick="checkPass()">Masuk</button>
      <p style="margin-top:15px;font-size:0.8rem;">Default: 1234</p>
    </div>
  </div>

  <header>
    <h1>Izzasza's Ultimate Gallery</h1>
    <p>Koleksi foto pribadi • est. 2025</p>
  </header>

  <div class="controls">
    <input type="text" id="search" placeholder="Cari foto...">
    <button id="upload_button">+ Upload Foto</button>
    <button onclick="document.body.classList.toggle('light')">Light Mode</button>
  </div>

  <div class="gallery" id="gallery"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
  <script>
    const PASSWORD = "1234";
    let isLoggedIn = false;
    function checkPass(){
      if(document.getElementById("pass").value === PASSWORD){
        isLoggedIn = true;
        document.getElementById("loginModal").style.display = "none";
      } else alert("Password salah!");
    }

    const myWidget = cloudinary.createUploadWidget({
      cloudName: 'dzkjz7cog',
      uploadPreset: 'unsigned_blog',
      folder: 'my-photo-blog',
      multiple: true
    }, (error, result) => {
      if(result && result.event === "success"){
        const data = {url: result.info.secure_url, likes:0, caption:""};
        saveCaptionAndLikes(result.info.public_id, data);
        addPhoto(data, result.info.public_id);
      }
    });
    document.getElementById("upload_button").addEventListener("click", ()=> isLoggedIn ? myWidget.open() : alert("Login dulu untuk upload!"));

    function saveCaptionAndLikes(id, data){
      let db = JSON.parse(localStorage.getItem("photoDB") || "{}");
      db[id] = data;
      localStorage.setItem("photoDB", JSON.stringify(db));
    }
    function getDB(){ return JSON.parse(localStorage.getItem("photoDB") || "{}"); }

    function addPhoto(data, publicId){
      const div = document.createElement("div");
      div.className = "photo";
      div.innerHTML = `
        <a href="${data.url}" data-fancybox="gallery">
          <img src="${data.url}" loading="lazy">
        </a>
        <div class="overlay">
          <input type="text" class="caption" placeholder="tulis caption..." value="${data.caption}" onchange="updateCaption('${publicId}',this.value)">
          <div class="actions">
            <button class="like" onclick="like(this,'${publicId}')">♥ ${data.likes}</button>
            <button onclick="download('${data.url}')">Download</button>
            ${isLoggedIn ? `<button class="delete" onclick="hapus('${publicId}',this)">× Hapus</button>` : ""}
          </div>
        </div>`;
      document.getElementById("gallery").prepend(div);
    }

    window.updateCaption = (id,val) => { let db=getDB(); db[id].caption=val; saveCaptionAndLikes(id,db[id]); }
    window.like = (el,id) => { let db=getDB(); db[id].likes++; saveCaptionAndLikes(id,db[id]); el.innerHTML = "♥ "+db[id].likes; }
    window.download = (url) => window.open(url);
    window.hapus = (id, el) => {
      if(confirm("Yakin hapus foto ini?")){
        el.closest(".photo").remove();
        let db=getDB(); delete db[id]; localStorage.setItem("photoDB",JSON.stringify(db));
      }
    };

    async function loadAll(){
      try{
        const res = await fetch('https://res.cloudinary.com/dzkjz7cog/image/list/my-photo-blog.json');
        const json = await res.json();
        const db = getDB();
        document.getElementById("gallery").innerHTML = "";
        json.resources.reverse().forEach(p => {
          const id = p.public_id;
          const saved = db[id] || {likes:0, caption:""};
          saved.url = `https://res.cloudinary.com/dzkjz7cog/image/upload/${id}`;
          addPhoto(saved, id);
        });
      }catch(e){ document.getElementById("gallery").innerHTML = "<p style='text-align:center;grid-column:1/-1;color:#888'>Belum ada foto. Upload yang pertama yuk!</p>"; }
    }

    document.getElementById("search").addEventListener("input", (e)=>{
      const term = e.target.value.toLowerCase();
      document.querySelectorAll(".photo").forEach(p=>{
        const cap = p.querySelector(".caption").value.toLowerCase();
        p.style.display = cap.includes(term) ? "block" : "none";
      });
    });

    loadAll();
  </script>
</body>
</html>
